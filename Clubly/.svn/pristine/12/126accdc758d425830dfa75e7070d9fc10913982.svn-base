@model Web.Models.Actividad
@using Web.Models
@{
    ViewBag.Title = "InscribirASocio";
}


<h2>Inscribirse a @Model.nombre</h2>

<div id="kendotableSocio">
@(Html.Kendo().Grid<Web.Models.Socio>()
    .Name("tablaSocio")
    .Columns(columns =>
    {
        columns.Bound(p => p.familia.id).Width(90).Title("Cod Familia");
        //columns.Bound(p => p.id).Width(70).Title("Id Socio");
        columns.Bound(p => p.persona.dni).Width(70);
        columns.Bound(p => p.persona.nombre).Width(70);
        columns.Bound(p => p.persona.apPaterno).Width(90).Title("Ap Paterno");
        columns.Bound(p => p.persona.apMaterno).Width(90).Title("Ap Materno");
        //columns.Bound(p =>(p.horaIngreso)).Title("Hora de Ingreso").Width(110);//.Format("{0: h:mm}");                           
        //columns.Bound(p => p.estado).Title("Estado").Width(60);//.Format("{0}-{1}","Inactivo","Activo");
        //columns.Command(command => { command.Destroy().Text("Cancelar"); }).Width(90);  
        columns.Command(c => c.Custom("Agregar").Click("Agregar")).Width(100);                               

    })
    .Groupable(group=>group.Messages(msg=>msg.Empty("Arrastre aquí para agrupar")))
    .Sortable()
    .Scrollable()//scr=>scr.Height(207))
    .Selectable()
    .Filterable(filterable => filterable
        .Extra(false)
        .Operators(operators => operators
            .ForString(str => str.Clear()
                .StartsWith("Empezar con")
                .IsEqualTo("Es igual a")
                .IsNotEqualTo("Diferente a"))
            .ForNumber(number => number.Clear()
                .IsGreaterThan("Es mayor a")
                .IsLessThan("Es menor a")
                .IsEqualTo("Es igual a")
                .IsNotEqualTo("Es diferente a"))
        )
    )
    .DataSource(datasource => datasource
        .Ajax()
        .Read(read => read.Action("LeerSociosNoInscritos", "GestionarActividad",@Model))
        .Group(groups => groups.Add(socio => socio.familia.id))
    )
)
 </div>

 <h2>Socios inscritos a @Model.nombre</h2>

<div id="kendotable">
@(Html.Kendo().Grid<Web.Models.SocioXActividad>()
    .Name("tablaSocioXActividad") 
    .Columns(columns =>
    {
        //columns.Bound(p => p.Actividad.nombre).Sortable(true);
        columns.Bound(p => p.Socio.persona.nombre).Width(70);
        columns.Bound(p => p.Socio.persona.apPaterno).Width(90).Title("Ap Paterno");
        columns.Bound(p => p.Socio.persona.apMaterno).Width(90).Title("Ap Paterno");
        columns.Bound(p =>(p.horaIngreso)).Title("Hora de Ingreso").Width(110);//.Format("{0: h:mm}");                           
        //columns.Bound(p => p.estado).Title("Estado").Width(60);//.Format("{0}-{1}","Inactivo","Activo");
        columns.Command(command => { command.Destroy().Text("Cancelar"); }).Width(90);                                         
    })
    .Sortable()
    .Scrollable()
    .Editable(editable => { editable.Mode(GridEditMode.InLine); editable.DisplayDeleteConfirmation("El regitro será eliminado ¿Desea continuar?"); })
    .Selectable()
    .Pageable()
    .Filterable(filterable => filterable
        .Extra(false)
        .Operators(operators => operators
            .ForString(str => str.Clear()
                .StartsWith("Empezar con")
                .IsEqualTo("Es igual a")
                .IsNotEqualTo("Diferente a"))
            .ForNumber(number => number.Clear()
                .IsGreaterThan("Es mayor a")
                .IsLessThan("Es menor a")
                .IsEqualTo("Es igual a")
                .IsNotEqualTo("Es diferente a"))
            )
    )
    .DataSource(datasource => datasource
        .Ajax()
        
        //.Update(upd => upd.Action("LeerSocioxActividad", "GestionarActividad", @Model))
        .Read(read => read.Action("LeerSocioxActividad", "GestionarActividad",@Model))
        .Model(model => model.Id(p => p.idSocio))
        .Destroy(destroy => destroy.Action("EliminarInscripcion", "GestionarActividad"))
        
    )
)
 </div>

 <script type="text/javascript">
    $(function () {
        var grid = $("#tablaSocioXActividad").data("kendoGrid");
 
        grid.table.on("mousedown", ".k-grid-Cancelar", $.proxy(Recargar, grid));
    });
    function Recargar(e){
        window.location=window.location;
    }
    function Agregar(e) {
        //alert("hola :(");
        e.preventDefault();
        var grid = $('#tablaSocio').data('kendoGrid');
        var row = grid.select();
        var dataItem = grid.dataItem(row);
        var id = dataItem.persona.id;
        //alert(id);
        $.ajax({
            url: '@Url.Action("AgregarSocioEnActividad")',
            type: 'POST',
            datatype: "json",
            traditional: true,
            data: { 
                strIdSocio: JSON.stringify(id),
                strIdActividad: JSON.stringify(@Model.id)
            },
            success: function () { 
                window.location=window.location;
            },
            error: function (event, request, settings) {  
                window.location=window.location; 
            },
            timeout: 20000
        });

    }
  </script>
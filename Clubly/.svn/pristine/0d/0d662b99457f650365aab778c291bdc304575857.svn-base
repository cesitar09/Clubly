@model Web.Models.ReservaBungalow
@using Web.Models
<fieldset>
    <legend>Datos de Perfil</legend>
    @using (Html.BeginForm()){
        <ul>
            <li>
                @(Html.Label("Sede"))
                @(Html.Kendo().DropDownList()
                      .Name("sede")
                      .HtmlAttributes(new { style = "width: 150px" })
                      .DataTextField("nombre")
                      .DataValueField("id")
                      .DataSource(source =>
                      {
                          source.Read(read =>
                          {
                              read.Action("ObtenerSedes", "Reservas");
                          });
                      })
                      .Events(ev => ev.Close((@<text>
                          function(e) {
                            cambioMapa(this.value());
                          }</text>)))
            )
            </li><li>
                @(Html.Label("Fecha Inicio"))
                @(Html.Kendo().DatePicker()
                    .Name("finicial") //The name of the datepicker is mandatory. It specifies the "id" attribute of the widget.
                    .HtmlAttributes(new { style = "width:150px" })
                    .Min(DateTime.Today) //Set min date of the datepicker
                    .Max(new DateTime(2015, 12, 31)) //Set min date of the datepicker
                    .Value(DateTime.Today) //Set the value of the datepicker
                    .Events(e => e.Change("startChange"))
                )
            </li><li>
                @(Html.Label("Fecha Final"))
                @(Html.Kendo().DatePicker()
                    .Name("ffinal") //The name of the datepicker is mandatory. It specifies the "id" attribute of the widget.
                    .HtmlAttributes(new { style = "width:150px" })
                    .Min(DateTime.Today) //Set min date of the datepicker
                    .Max(new DateTime(2015, 12, 31)) //Set min date of the datepicker
                    .Value(DateTime.Today) //Set the value of the datepicker
                    .Events(e => e.Change("endChange"))
                )
            </li><li>
                <img id="img" src='../../Content/img/2.jpg' width="400" height="250" />
            </li>
        </ul>
        <div id="botones">
            <input type="button" value="Consultar Disponibilidad" id="AgregarPermiso" onclick="Javascript: AbrirPopup() "   />
        </div>
    }
</fieldset>

<script>
    function startChange() {
        var endPicker = $("#ffinal").data("kendoDatePicker"),
            startDate = this.value();

        if (startDate) {
            startDate = new Date(startDate);
            startDate.setDate(startDate.getDate() + 1);
            endPicker.min(startDate);
        }
    }

    function endChange() {
        var startPicker = $("#finicial").data("kendoDatePicker"),
            endDate = this.value();

        if (endDate) {
            endDate = new Date(endDate);
            endDate.setDate(endDate.getDate() - 1);
            startPicker.max(endDate);
        }
    }

    function obtenerUrlMapa(value) {
        $.ajax({
            url: '@Url.Action("ObtenerUrlImagen")',
            type: 'POST',
            datatype: "json",
            traditional: true,
            data: {
                id: JSON.stringify(value),
            },
            success: function (valor) {
                models = [];
                document.getElementById("img").src = valor;
            },
            error: function (event, request, settings) {
                models = [];
                window.alert("Ocurrió un error en su transacción");
            },
            timeout: 20000
        });
    }

    function cambioMapa(id) {
        document.getElementById("img").src = obtenerUrlMapa(id);
    }
</script>

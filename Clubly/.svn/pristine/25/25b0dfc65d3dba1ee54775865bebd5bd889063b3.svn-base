@model Web.Models.Concesionario
@using Web.Models
@{
    ViewBag.Title = "Mantener Concesionario";
}

<h1>@ViewBag.Title</h1>

<fieldset>
    <legend>Datos del concesionario</legend>
    @using (Html.BeginForm("InsertarConcesionario", "Logistica", FormMethod.Post, new { @id = "form" }))
    {
        <ul>
            <li>
                <div class="editor-label">@Html.LabelFor(p => p.id)</div>
                @Html.TextBoxFor(p => p.id, new { @readonly = "readonly" })
            </li><li>
                <div class="editor-label">@Html.LabelFor(p => p.nombre)</div>
                @Html.TextBoxFor(p => p.nombre)
                @if (Model != null)
                {
                    <div id="validacion">@Html.ValidationMessageFor(p => p.nombre)</div>
                }
            </li><li>
                <div class="editor-label">@Html.LabelFor(p => p.direccion)</div>
                @Html.TextBoxFor(p => p.direccion)
                @if (Model != null)
                {
                    <div id="validacion">@Html.ValidationMessageFor(p => p.direccion)</div>
                }
            </li><li>
                <div class="editor-label">@Html.LabelFor(p => p.ruc)</div>
                @Html.TextBoxFor(p => p.ruc)
                @if (Model != null)
                {
                    <div id="validacion">@Html.ValidationMessageFor(p => p.ruc)</div>
                }
            </li><li class="long">
                <div class="editor-label">@Html.LabelFor(p => p.sedes)</div>
                @(Html.Kendo().MultiSelectFor(p => p.sedesAux)
                    .DataTextField("nombre")
                    .DataValueField("id")
                    .Placeholder("Elegir sedes...")
                    .BindTo(Sede.SeleccionarTodo())
                    .Value(Model != null ? Sede.Enlistar(Model.sedes) : null)
                )
                @if (Model != null)
                {
                    <div id="validacion">@Html.ValidationMessageFor(p => p.sedesAux)</div>
                }
            </li>
                @Html.TextBoxFor(p => p.estado, "", new { style = "display:none;" })
        </ul>
        <div id="botones">
            <input type="button" value="Limpiar" id="Limpiar" onclick="location.href = '@(Url.Action("MantenerConcesionario", "Logistica"))'" />
            <input type="submit" value=@(Model == null || Model.id == 0 ? "Insertar" : "Modificar") />
        </div>
    }
</fieldset>

<div id="kendotable">
    @(Html.Kendo().Grid<Web.Models.Concesionario>()
        .Name("Grid")
        .Columns(columns =>
        {
            columns.Bound(p => p.nombre);
            columns.Bound(p => p.direccion);
            columns.Bound(p => p.ruc);
            columns.Command(c => { c.Custom("Editar").Click("EditarConcesionario"); c.Destroy().Text("Eliminar"); });
        }
        )
        .Editable(editable => { editable.Mode(GridEditMode.InLine); editable.DisplayDeleteConfirmation("El regitro será eliminado ¿Desea continuar?"); })
        .Pageable()
        .Sortable()
        .Filterable(filterable => filterable
            .Operators(op => op
                .ForString(s => s.Clear()
                    .StartsWith("Inicia con")
                    .Contains("Contiene")
                    .DoesNotContain("No contiene")
                )
            )
        )
        .DataSource(d => d.Ajax()
            .Read(r => r.Action("LeerConcesionario", "Logistica"))
            .Model(m => m.Id(p => p.id))
            .Destroy(a => a.Action("EliminarConcesionario", "Logistica"))
            )
            .Selectable()
    )
</div>

<script type="text/javascript">
    function EditarConcesionario(e) {
        e.preventDefault();
        var grid = $('#Grid').data('kendoGrid');
        var row = grid.select();
        var dataItem = grid.dataItem(row);
        var id = dataItem.id;
        location = "@Url.Action("EditarConcesionario")" + "?id=" + id;
    }

</script>